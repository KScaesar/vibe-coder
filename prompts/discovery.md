---
name: discovery
description: 探索規格歧義與遺漏決策點
---

# Discovery

## 目標

查看規格檔案(`spec_**.md` or `feat_**.md`)，識別所有未釐清、歧義或遺漏的決策點，產出結構化釐清項目檔案至 `.clarify/` 資料夾。

## 執行步驟

### 1. 掃描檢查清單
對規格進行系統化檢查，標記狀態（Clear / Partial / Missing）：

**資料模型（erm.dbml）**
- 實體與屬性完整性、命名清晰度
- 屬性型別、值域邊界、約束條件
- 跨屬性計算關係與不變條件
- 實體關係（1:1, 1:N, M:N）與外鍵
- 狀態定義與轉換規則

**功能模型（features/*.feature）**
- 功能識別與命名、交互時機
- 規則原子性（每條 Rule 只驗證一件事）
- 前置/後置條件完整性
- **Example 覆蓋度**：每條 Rule 至少一個 Example（必要）
- 邊界條件：數值臨界、組合衝突、狀態切換
- 錯誤與異常處理

**術語一致性**
- 同義詞混用、同名異義
- 核心概念命名一致性

### 2. 產生釐清項目
**檢查已解決項目**：先掃描 `.clarify/resolved/` 避免重複提問

**檔案路徑規則**：
- 資料模型：`.clarify/data/<實體名>_<問題全句>.md`
- 功能模型：`.clarify/features/<功能名>_<問題全句>.md`

**釐清項目格式**：
```markdown
# 釐清問題
<完整問題句子>

# 定位
<ERM: 哪個實體/屬性？Feature: 哪個功能/規則？>

# 多選題
| 選項  | 描述             |
| ----- | ---------------- |
| A     | <選項描述>       |
| B     | <選項描述>       |
| Short | 簡短答案 (<=5字) |

# 影響範圍
<影響哪些實體/功能/規則/測試>

# 優先級
<High/Medium/Low>
```

### 3. 產生 overview.md
包含：
- 釐清項目統計（資料/功能分類、優先級分佈）
- **建議釐清順序**（由核心至延伸、平衡資料與功能）
- 覆蓋度摘要（Clear/Partial/Missing 狀態）

## 行為規則
- 純偵測角色，不進行互動釐清
- 完整掃描所有 Partial/Missing 項目
- 優先級依「影響 × 不確定性」評估
- 避免臆測與複合問題
- 釐清結果需可直接轉換為規格更新

## 輸出
1. 釐清項目檔案 → `.clarify/data/*.md` 或 `.clarify/features/*.md`
2. 總覽文件 → `.clarify/overview.md`
3. 完成報告：統計、優先級分佈、後續建議